<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Books</title>
    <link href="stylesheets/books.css" type="text/css" rel="stylesheet">
  </head>
  <body>
    <div class = content>
      <div id = heading>
        <img onload="this.style.opacity='1';" src="http://www.alwaysjkrowling.com/wp-content/uploads/2014/12/JKRHeader.jpg" />
          <h1>The Chubby Cups</h1>
      </div>
      <ul class="tab">
        <li><a href="/" class="tablinks" >Home</a></li>
        <li><a href="/breakout" class="tablinks" >Search</a></li>
        <li><a href="/mybooks" class="tablinks" >My Books</a></li>
        <li><a href="/aboutus" class="tablinks" >About Us</a></li>
        <li><a href="/notes" class="tablinks" >Notes</a></li>
        <li><a href="/signin" class="tablinks" >Sign-in</a></li>
        <li><a href="/new" class="tablinks" >New</a></li>
      </ul>

      <p>This is the results page</p>
      <p>What's up? Why not?</p>
      <div id="books">
      </div>


    </div>

    <script type="text/javascript">
    var httpRequest = new XMLHttpRequest();

    function nameOfTheFunction() {
      if (httpRequest.readyState === XMLHttpRequest.DONE) {
        console.log(JSON.parse(httpRequest.responseText));
        var items = JSON.parse(httpRequest.responseText).items; //going to iterate over the array of items
        console.log(items);

        for (var i =0; i < items.length; i++) {
          var country =items[i].saleInfo.country;
          var title =items[i].volumeInfo.title;
          var date = items[i].volumeInfo.publishedDate;
          var language = items[i].volumeInfo.language;
          var authors = items[i].volumeInfo.authors;
          var id = items[i].id;
          console.log("This is the book # "+ (i+1))


        // Problem - this for loop only works if the "authors" array exists in items[i]
        //            if it doesn't, the loop returns an error.
        // Solution - condition could be : if authors exists (?)

        // for (var a=0; a< items[i].volumeInfo.authors.length ; a++) {
        //   if (items[i].volumeInfo.authors[a]){
        //     alert(items[i].volumeInfo.authors[a]);
        //   }
        //   else {
        //     console.log("No author");
        //   }
        // }
 -->
        //  console.log(items[i];
<!-- test code
          var book = document.createElement("a");
          console.log("test1");
          book.href = "/book?id=" + id;
          book.text = country + title + date + language + authors + id;
          console.log("test2");
          books.appendChild(book);
          document.createElement("br");
-->
      }
    //  else {
    // still not ready
      //    }
      }
    }
    var my_search = "Pride and Prejudice";
    var my_search_list = my_search.split(" ");
    my_search = "";
    for (var i = 0; i < my_search_list.length; i++){
      my_search = my_search + '+' + my_search_list[i];
    }
    my_search = my_search + "&filter=free-ebooks"
    httpRequest.open('GET', 'https://www.googleapis.com/books/v1/volumes?q=' + my_search, true);
    httpRequest.send(null);
    httpRequest.onreadystatechange = nameOfTheFunction;


    </script>

  </body>
    <div id ="wrapper">
    <footer>

    <p>This code is brought to you in part by the CSSI 2016 in MTV. Thanks to all the Google employees, interns, and TAs who made this site possible.</p>

  </footer>
  </div>
</html>
